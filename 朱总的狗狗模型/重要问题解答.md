# 重要问题解答

## 问题1: 重力对齐坐标系和虚拟坐标系是否一样？

### 答案：**是的，基本一致**

**重力对齐坐标系（Gravity-Aligned Frame）** 就是相对于重力方向定义的虚拟坐标系：

- **垂直轴（Vertical）**: 沿重力方向（向下为正方向）
- **水平面（Horizontal）**: 垂直于重力方向的平面

这个坐标系是**动态的**，因为：
- 它会根据重力方向自动调整
- 但相对于重力方向是**固定的**
- 不依赖于传感器的安装方向

### 与传感器坐标系的关系

- **传感器坐标系**: 固定在传感器硬件上（X/Y/Z轴）
- **重力对齐坐标系**: 相对于重力方向，是虚拟的、动态的坐标系

**转换过程**:
```
传感器坐标系 (ax, ay, az) 
    ↓ [坐标变换]
重力对齐坐标系 (a_vert, a_hor)
```

---

## 问题2: 模型是否直接输入IMU生数据？传感器参数是什么？

### 答案：**不是，模型输入的是预处理后的16个特征**

### 数据流程

```
原始IMU数据 (6轴)
    ↓ [特征提取]
16个特征通道 (已处理)
    ↓ [归一化]
模型输入 (N, 500, 16)
```

### 模型输入要求

**模型不直接接受原始IMU数据**，需要先进行特征提取：

1. **输入格式**: `(N, 500, 16)` - 16个已处理的特征通道
2. **不是原始数据**: 不是直接的 `(ax, ay, az, gx, gy, gz)` 6轴数据

### 如果您有原始IMU数据，需要先转换为16个特征

**原始IMU数据要求**:
- **加速度计**: ax, ay, az（单位：m/s²）
- **陀螺仪**: gx, gy, gz（单位：rad/s 或 deg/s，需要确认）
- **采样频率**: 建议100Hz（然后窗口化为500个时间步，约5秒）

**传感器参数（推测）**:
- **加速度计量程**: ±2g 或 ±4g（常见IMU传感器）
- **陀螺仪量程**: ±250°/s 或 ±500°/s（常见IMU传感器）
- **采样频率**: 100Hz（根据500时间步/5秒推断）

> ⚠️ **注意**: 这些参数是基于数据格式推测的，实际传感器参数需要查看原始数据采集文档。

### 特征提取步骤

如果您要从原始IMU数据生成模型输入，需要：

1. **坐标系转换**: 传感器坐标系 → 重力对齐坐标系
2. **计算11个动态特征**: a_vert, a_hor, cos_theta_a, sin_theta_a, w_vert, w_hor, cos_theta_w, sin_theta_w, pitch, roll, is_static
3. **添加5个静态特征**: Breed, Weight, Age months, Gender, NeuteringStatus
4. **归一化**: 使用训练时的均值和标准差进行z-score归一化

---

## 问题3: 个体静态属性特征的编码表是什么？

### 答案：**需要从数据中提取，以下是基于数据统计的推测**

### 静态特征编码（基于数据统计）

#### 1. **Breed** - 品种
- **类型**: 数值编码（整数）
- **范围**: 从数据统计看，均值约11.72，标准差约6.76
- **推测**: 可能是品种ID（1, 2, 3, ...），需要查看原始数据确定具体映射

#### 2. **Weight** - 体重
- **类型**: 连续数值（单位：kg）
- **范围**: 均值约23.83 kg，标准差约6.96 kg
- **编码**: 直接使用体重值（kg），无需编码

#### 3. **Age months** - 年龄（月）
- **类型**: 连续数值（单位：月）
- **范围**: 均值约57.65个月（约4.8岁），标准差约28.71个月
- **编码**: 直接使用年龄值（月），无需编码

#### 4. **Gender** - 性别
- **类型**: 数值编码（二值或分类）
- **范围**: 均值约1.48，标准差约0.50
- **推测编码**:
  - `0` = 雌性（Female）
  - `1` = 雄性（Male）
  - 或者 `1` = 雌性，`2` = 雄性
- **需要确认**: 从均值1.48看，可能是1和2的编码

#### 5. **NeuteringStatus** - 绝育状态
- **类型**: 数值编码（二值）
- **范围**: 均值约0.35，标准差约0.48
- **推测编码**:
  - `0` = 未绝育（Not Neutered）
  - `1` = 已绝育（Neutered）
- **确认**: 从均值0.35看，约35%的样本已绝育，符合二值编码

### 如何获取完整的编码表

**方法1: 查看数据文件**
```python
import numpy as np

data = np.load("DogWindows_5sL500_S200__3/windows_all.npz", allow_pickle=True)
X = data['X']
cols = data['cols'].tolist()

# 查看Breed的唯一值
breed_idx = cols.index('Breed')
unique_breeds = np.unique(X[:, 0, breed_idx])  # 取第一个时间步（静态特征相同）
print("Breed编码:", unique_breeds)

# 查看Gender的唯一值
gender_idx = cols.index('Gender')
unique_genders = np.unique(X[:, 0, gender_idx])
print("Gender编码:", unique_genders)

# 查看NeuteringStatus的唯一值
neutering_idx = cols.index('NeuteringStatus')
unique_neutering = np.unique(X[:, 0, neutering_idx])
print("NeuteringStatus编码:", unique_neutering)
```

**方法2: 查看原始数据采集文档**
- 如果有数据采集时的元数据文档，应该包含完整的编码表

### 使用建议

1. **Weight和Age months**: 直接使用实际值（kg和月）
2. **Gender和NeuteringStatus**: 使用二值编码（0/1）
3. **Breed**: 需要确定品种ID映射表，或使用one-hot编码

### 示例：如何准备静态特征

```python
# 假设您有狗的元数据
dog_metadata = {
    'breed': '拉布拉多',      # 需要转换为ID
    'weight': 25.5,          # kg，直接使用
    'age_months': 36,        # 月，直接使用
    'gender': 'Male',        # 需要转换为编码（如1）
    'neutered': True         # 需要转换为编码（如1）
}

# 转换为模型输入格式
static_features = [
    breed_id,              # Breed: 需要查找品种ID
    dog_metadata['weight'], # Weight: 直接使用
    dog_metadata['age_months'], # Age months: 直接使用
    gender_code,           # Gender: 0或1
    neutering_code         # NeuteringStatus: 0或1
]
```

---

## 总结

1. **坐标系**: 重力对齐坐标系就是相对于重力方向的虚拟坐标系，与您说的虚拟坐标系一致
2. **模型输入**: 不是原始IMU数据，而是预处理后的16个特征
3. **静态特征编码**: 
   - Weight和Age months直接使用数值
   - Gender和NeuteringStatus使用0/1编码
   - Breed需要品种ID映射表

---

## 下一步建议

1. **运行查看数据脚本**: 使用 `查看数据详情.py` 获取准确的编码值
2. **查找原始文档**: 如果有数据采集文档，查看完整的编码表
3. **特征提取代码**: 如果需要从原始IMU数据生成特征，需要实现特征提取函数
